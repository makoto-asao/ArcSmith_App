# 技術仕様書：Jホラー動画自動制作システム（仮）

## 1. システム概要
本システムは、Jホラーショート動画の制作プロセス（ネタ出し、台本作成、画像生成、動画編集ツールのセットアップ）を自動化および半自動化するPythonベースのツールです。Google Sheetsをマスターデータとし、Gemini API、Midjourney、Vrewを連携させます。

## 2. アーキテクチャ構成
本システムは以下の4つのコンポーネントで構成されます。

### 2.1 データ管理 (Google Sheets API / gspread)
- **役割**: 動画ネタ、台本、進捗状況の集中管理。
- **データ構造**:
  - `ネタ（タイトル）`: A列
  - `動画構成（台本）`: B列
  - `画像生成プロンプト`: C列
  - `完了フラグ`: D列
  - `作成日`: E列
  - `備考`: F列

### 2.2 AIロジック (Gemini API)
- **役割**: ネタの考案、動画スクリプトの作成、画像生成用プロンプトの抽出。
- **モデル**: `gemini-1.5-flash` または `gemini-1.5-pro`

### 2.3 ブラウザ自動化 (Playwright)
- **Midjourney**: WebインターフェースまたはDiscord経由でプロンプトを入力し、画像をダウンロード。
- **Vrew**: 台本をアップロードし、動画プロジェクトの初期状態を作成。

### 2.4 GUI層 (Streamlit)
- **役割**: ユーザーへの進捗表示、認証セッションの取得（手動ログイン後のCookie保存）、画像選定（半自動モード）のUI提供。

## 3. ワークフロー詳細

### モードA: ネタ企画・重複チェック
1. スプレッドシートの既存ネタを全取得。
2. 取得リストをGeminiに渡し、「これらと重複しない、Jホラーに特化したバズるネタを5つ提案せよ」と指示。
3. 生成されたネタをGoogle Sheetsの末尾に追加。

### モードB: 台本・プロンプト生成
1. スプレッドシートから「完了フラグ」が空のネタを1つ取得。
2. Geminiに「監督・マーケター」のロールを与え、以下を生成させる。
   - **Vrew用テキスト**: ナレーションと字幕用。
   - **Midjourney用プロンプト**: 各シーン（例: 4〜6シーン）の描写。
3. 生成結果をパースし、スプレッドシートの各列に書き込み。

### モードC: アセット生成・連携
1. **Midjourney自動操作**:
   - Playwrightを起動（既存セッション利用）。
   - プロンプトを1つずつ入力。
   - 生成完了を検知（要素の出現待ち）。
   - 4枚のバリエーションからU1（1枚目）をダウンロード。
2. **Vrew自動操作**:
   - Vrew Web版を開く。
   - 「テキストからビデオを作成」を選択。
   - スクリプトを自動ペースト。
   - 動画生成プロセスの初期化を完了させる。

## 4. 技術的制約・セキュリティ
- **認証管理**: Playwrightの `storage_state` を使用し、有効期限が切れるまで手動ログインを不要にする。
- **検知回避**: MidjourneyのBot検知を避けるため、`slow_mo` オプションを使用し、不規則なウェイトを入れる。
- **エラー処理**: APIエラーやブラウザのタイムアウト時に、スプレッドシートにエラー内容を記録するリトライロジックを実装。
